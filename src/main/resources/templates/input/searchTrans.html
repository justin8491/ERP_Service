<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns="http://www.w3.org/1999/html"
      layout:decorate="~{include/layout/defaultLayout}">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-..." crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>
<th:block layout:fragment="Content">
    <div style="width : 80%; margin: 0 auto">
        <div style="display:flex; justify-content:space-between;">
            <select style="width:120px;" class="form-select form-select-lg mb-3" aria-label=".form-select-lg example">
                <option selected>10</option>
                <option value="1">20</option>
                <option value="2">50</option>
                <option value="3">100</option>
            </select>
            <div class="input-group rounded" style="width:350px;">
                <div style="display:flex;">
                    <form action="/input/transaction" style="padding:5px;">
                        <input type="submit" value="전체보기" class="input-group-text border-0">
                    </form>
                    <form method="post" action="/input/searchTrans" style="display:flex;">
                        <input type="search" class="form-control rounded" placeholder="Search" aria-label="Search"
                               aria-describedby="search-addon" name="keyword"/>
                        <button class="input-group-text border-0" id="search-addon" style="height:42px;"><i class="fas fa-search"></i></button>
                    </form>
                </div>
            </div>
        </div>
        <table class="table">
            <thead>
            <tr>
                <th scope="col" style="text-align: center;">발주코드</th>
                <th scope="col" style="text-align: center;">상품명</th>
                <th scope="col" style="text-align: center;">수량</th>
                <th scope="col" style="text-align: center;">납기일자</th>
                <th scope="col" style="text-align: center;">협력업체</th>
                <th scope="col" style="text-align: center;">발주상태</th>
            </tr>
            </thead>
            <tbody class="table-group-divider" th:each="trans : ${list}">
            <!-- 거래 정보 목록 렌더링 -->
            <tr>
                <td style="text-align: center;" th:text="${trans.orderCode}">발주코드</td>
                <td style="text-align: center;" th:text="${trans.itemName}">상품명</td>
                <td style="text-align: center;" th:text="${trans.qty}">수량</td>
                <td style="text-align: center;" th:text="${trans.leadtime}">납기일자</td>
                <td style="text-align: center;" th:text="${trans.supName}">협력업체</td>
                <td style="text-align: center;" th:text="${trans.status}">발주상태</td>
            </tr>
            <tr th:if="${#lists.isEmpty(trans)}">
                <td colspan="6" style="text-align: center;">거래 명세서가 없습니다.</td>
            </tr>
            </tbody>
        </table>
        </div>
        </div>
    </div>
</th:block>
</body>
</html>

<script>
     $(document).ready(function() {
    $('.modal-btn').click(function() {
        // 클릭된 버튼의 부모 행을 찾음
        var row = $(this).closest('tr');

        // 행의 각 데이터 값을 추출
        var id = row.find('th[scope="col"]:nth-child(1)').text();
        var recDate = row.find('th[scope="col"]:nth-child(2)').text();
        var supName = row.find('th[scope="col"]:nth-child(3)').text();
        var invenName = row.find('th[scope="col"]:nth-child(4)').text();
        var itemName = row.find('th[scope="col"]:nth-child(5)').text();
        var qty = row.find('th[scope="col"]:nth-child(6)').text();

        // 모달 테이블에 데이터를 삽입
        var tableRow = `
            <tr>
                <th id="numVal" scope="col" colspan="1">${id}</th>
                <th scope="col" colspan="1" style="text-align: center;">${recDate}</th>
                <th scope="col" colspan="1" style="text-align: center;">${supName}</th>
                <th scope="col" colspan="2" style="text-align: center;">${invenName}</th>
                <th scope="col" colspan="4" style="text-align: center;">${itemName}</th>
                <th scope="col" colspan="1" style="text-align: center;">${qty}</th>
                <th scope="col" colspan="2" style="text-align: center;">
                    <select id="selectVal" name="inspectionStatus">
                        <option value="진행중">진행중</option>
                        <option value="완료">완료</option>
                     </select>
                </th>
                <input type="hidden" name="numVal" value="${id}">
            </tr>`;
        // 모달의 테이블에 데이터 추가
        $('.modal-table').html(tableRow);
    });
});
</script>
